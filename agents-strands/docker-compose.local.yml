services:
  travel-assistant-agent:
    image: travel-assistant-agent:latest
    build:
      context: ./src/travel-assistant-agent
      dockerfile: Dockerfile
      args:
        TARGETPLATFORM: linux/arm64
    container_name: travel-assistant-agent
    ports:
      - "9001:9000"  # Map host port 9001 to associated container port 9000 for local testing
    environment:
      - DB_PATH=/app/data/flights.db
      - AWS_REGION=us-east-1
      - AWS_DEFAULT_REGION=us-east-1
      - AGENT_NAME=travel-assistant
      - AGENTCORE_RUNTIME_URL=http://travel-assistant-agent:9000/
      # AWS Credentials (passed from host)
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN}
    volumes:
      - travel_assistant_data:/app/data
      - ~/.aws:/home/bedrock_agentcore/.aws:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  flight-booking-agent:
    image: flight-booking-agent:latest
    build:
      context: ./src/flight-booking-agent
      dockerfile: Dockerfile
      args:
        TARGETPLATFORM: linux/arm64
    container_name: flight-booking-agent
    ports:
      - "9002:9000"  # Map host port 9002 to associated container port 9000 for local testing
    environment:
      - DB_PATH=/app/data/bookings.db
      - AWS_REGION=us-east-1
      - AWS_DEFAULT_REGION=us-east-1
      - AGENT_NAME=flight-booking
      - AGENTCORE_RUNTIME_URL=http://flight-booking-agent:9000/
      # AWS Credentials (passed from host)
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN}
    volumes:
      - flight_booking_data:/app/data
      - ~/.aws:/home/bedrock_agentcore/.aws:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    depends_on:
      - travel-assistant-agent

volumes:
  travel_assistant_data:
    driver: local
  flight_booking_data:
    driver: local